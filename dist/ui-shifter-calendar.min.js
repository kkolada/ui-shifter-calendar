!function(){"use strict";!function(){angular.module("UI.Shifter.Calendar",[])}(),angular.module("UI.Shifter.Calendar",["src/templates/ui-shifter-calendar.tpl.html"]),angular.module("src/templates/ui-shifter-calendar.tpl.html",[]).run(["$templateCache",function(a){a.put("src/templates/ui-shifter-calendar.tpl.html",'<div class=ui-shifter-calendar><table id="{{vm.id + \'-Table\'}}" ng-class="[\'ui-shifter-calendar-week-wrapper\', {shadow: vm.shadow}]"><thead><tr><th></th><th ng-if=vm.dayFilter.mon colspan={{vm.teams.length}}>Monday</th><th ng-if=vm.dayFilter.tue colspan={{vm.teams.length}}>Tuesday</th><th ng-if=vm.dayFilter.wed colspan={{vm.teams.length}}>Wednesday</th><th ng-if=vm.dayFilter.thu colspan={{vm.teams.length}}>Thursday</th><th ng-if=vm.dayFilter.fri colspan={{vm.teams.length}}>Friday</th><th ng-if=vm.dayFilter.sat colspan={{vm.teams.length}}>Saturday</th><th ng-if=vm.dayFilter.sun colspan={{vm.teams.length}}>Sunday</th></tr><tr class=subhead><th></th><th ng-if=vm.dayFilter.mon ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.tue ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.wed ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.thu ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.fri ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.sat ng-repeat="team in vm.teams">{{team}}</th><th ng-if=vm.dayFilter.sun ng-repeat="team in vm.teams">{{team}}</th></tr></thead><tbody><tr class=first-half-hour ng-repeat-start="hour in vm.hours track by $index"><td id="{{vm.id + \'-\' + hour.time}}">{{hour.time}}</td><td id="{{vm.id + \'-\' + hour.time + \'-Monday-\' + team}}" ng-if=vm.dayFilter.mon ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Tuesday-\' + team}}" ng-if=vm.dayFilter.tue ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Wednesday-\' + team}}" ng-if=vm.dayFilter.wed ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Thursday-\' + team}}" ng-if=vm.dayFilter.thu ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Friday-\' + team}}" ng-if=vm.dayFilter.fri ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Saturday-\' + team}}" ng-if=vm.dayFilter.sat ng-repeat="team in vm.teams"></td><td id="{{vm.id + \'-\' + hour.time + \'-Sunday-\' + team}}" ng-if=vm.dayFilter.sun ng-repeat="team in vm.teams"></td></tr><tr class=second-half-hour ng-repeat-end><td>&nbsp;</td><td ng-if=vm.dayFilter.mon ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.tue ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.wed ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.thu ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.fri ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.sat ng-repeat="team in vm.teams"></td><td ng-if=vm.dayFilter.sun ng-repeat="team in vm.teams"></td></tr></tbody></table></div>')}]),function(){function a(a,b,c,d){function e(a,b){var d=a.substring(0,2),e=a.substring(3,5),f=b.substring(0,2),g=b.substring(3,5),h=c({hour:d,minute:e});return c({hour:f,minute:g}).diff(h,"minutes")}function f(a,b){var c=a.substring(0,2)+":00",d=e(c,a),f=0;if(d>0){var g=d%30,h=(d-g)/30,i=g/30;f=b*h+Math.round(b*i+.5)-1}return f}function g(a,b){var c=a%30,d=(a-c)/30,e=c/30;return b*d+Math.round(b*e)-5}function h(a,b){var c=i(b),d=c.numerator/c.denominator;return Math.round(a*d)-5}function i(a){return{numerator:parseInt(a.substring(0,1)),denominator:parseInt(a.substring(2,3))}}function j(a,b,c){var d=i(b),e=1/d.denominator;return Math.round(c*e)*a}function k(c,d,e,f){var g=a[0].getElementById(c+"-"+f.substring(0,2)+":00-"+d+"-"+e);if(null!==g)var h=g.getBoundingClientRect(),i=Math.round(h.top),j=Math.round(h.left),k=Math.round(h.width),l=Math.round(h.height);return{left:b.scrollX+j+3,top:b.scrollY+i+2,width:k,height:l}}function l(c){var d=a[0].getElementById(c+"-Table");if(null!==d)var e=d.getBoundingClientRect(),f=e.top,g=e.height;return Math.round(b.scrollY+f+g)}function m(a,c){var d=l(a),e=c.top+b.scrollY+c.height,f=0;return d<e&&(f=e-d),f}function n(a,b,c){var d=0,f=0,i=null;return e(b,c.from)<0&&e(b,c.to)>0&&(i=k(a,c.day,c.team,b),d=g(e(b,c.to),i.height),f=h(i.width,c.fraction)),{coordinates:i,height:d,width:f}}var o={};return o.createBooking=function(b,c,i){var l=b+"-"+c.from.substring(0,2)+":00-"+c.day+"-"+c.team,o=k(b,c.day,c.team,c.from),p=angular.element('<div class="'+d.BOOKING+'"><span>'+c.fraction+"<br>"+c.from+" - "+c.to+"</span></div>"),q=g(e(c.from,c.to),o.height),r=h(o.width,c.fraction);q&&!isNaN(q)&&(p[0].style.height=q+"px"),r&&!isNaN(r)&&(p[0].style.width=r+"px");var s=o.left-1,t=o.top;isNaN(s)||(s+=j(c.position,c.fraction,o.width),p[0].style.left=s+"px"),isNaN(t)||(t+=f(c.from,o.height),p[0].style.top=t+"px");var u=a[0].getElementById(l);if(null!==u)angular.element(u).append(p);else{var v=n(b,i,c);if(0!==v.width&&0!==v.height){p[0].style.height=v.height+"px",p[0].style.width=v.width+"px",t=v.coordinates.top,p[0].style.top=t+"px",s=v.coordinates.left-1,s+=j(c.position,c.fraction,v.coordinates.width),p[0].style.left=s+"px";var w=a[0].getElementById(b+"-"+i+"-"+c.day+"-"+c.team);angular.element(w).append(p),p.addClass("cutTop")}}var x=m(b,p[0].getBoundingClientRect());if(x>0){var y=p[0].style.height.indexOf("px"),z=parseInt(p[0].style.height.substring(0,y));p[0].style.height=z-x+"px",p.hasClass("cutTop")?(p.removeClass("cutTop"),p.addClass("cutTopAndBottom")):p.addClass("cutBottom")}},o}angular.module("UI.Shifter.Calendar").factory("uiShifterCalendarEvent",["$document","$window","$moment","eventConst",a])}(),function(){angular.module("UI.Shifter.Calendar").constant("$moment",moment).constant("eventConst",{OPEN_HOUR:"openHour",BOOKING:"booking",SHIFT:"shift"})}(),function(){function a(a,b,c,d,e,f,g){var h=this,i=[];h.hours=[];var j=function(a,b){for(var d=[],e=a;e<=b;e++)d.push({time:c({hour:e,minute:0}).format("HH:mm")});h.hours=d},k=function(){l(),i.forEach(function(a){f.createBooking(h.id,a,h.hours[0].time)})},l=function(){for(var a=b[0].getElementsByClassName(d.BOOKING);a.length>0;)a[0].parentNode.removeChild(a[0])};a.$watch("vm.timeFilter",function(a,c){j(a.start,a.end),angular.element(b[0]).ready(function(){k()})},!0),a.$watchGroup(["vm.dayFilter","vm.teams"],function(a,c){angular.element(b[0]).ready(function(){k()})},!0),a.$watch("vm.events",function(a,c){i=e.sortEvents(h.events),angular.element(b[0]).ready(function(){k()})},!0),angular.element(b[0]).ready(function(){k()}),angular.element(g).bind("resize",function(){k()})}angular.module("UI.Shifter.Calendar").controller("uiShifterCalendarCtrl",["$scope","$document","$moment","eventConst","uiShifterEvent","uiShifterCalendarEvent","$window",a])}(),function(){function a(){return{restrict:"AE",templateUrl:"src/templates/ui-shifter-calendar.tpl.html",controller:"uiShifterCalendarCtrl",controllerAs:"vm",scope:{id:"@",events:"=",teams:"=",timeFilter:"=",dayFilter:"=",shadow:"="},bindToController:!0}}angular.module("UI.Shifter.Calendar").directive("uiShifterCalendar",a)}(),function(){function a(){function a(a){var b=-1;switch(a){case"Monday":b=0;break;case"Tuesday":b=1;break;case"Wednesday":b=2;break;case"Thursday":b=3;break;case"Friday":b=4;break;case"Saturday":b=5;break;case"Sunday":b=6}return b}function b(a){var b=-1;switch(a){case"openHour":b=0;break;case"booking":b=1;break;case"shift":b=2}return b}function c(a,b){return a-b}var d={};return d.sortEvents=function(d){var e=angular.copy(d);return e.sort(function(d,e){var f=c(a(d.day),a(e.day)),g=c(b(d.type),b(e.type));return 0==g?f:g}),e},d}angular.module("UI.Shifter.Calendar").factory("uiShifterEvent",a)}()}();