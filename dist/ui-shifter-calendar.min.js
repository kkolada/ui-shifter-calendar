!function(){"use strict";!function(){angular.module("UI.Shifter.Calendar",[])}(),angular.module("UI.Shifter.Calendar",["src/templates/ui-shifter-calendar.tpl.html"]),angular.module("src/templates/ui-shifter-calendar.tpl.html",[]).run(["$templateCache",function(a){a.put("src/templates/ui-shifter-calendar.tpl.html","<div class=ui-shifter-calendar><table id=\"{{vm.id + '-Table'}}\" ng-class=\"['ui-shifter-calendar-week-wrapper', {shadow: vm.shadow}]\"><thead><tr><th></th><th ng-if=vm.dayFilter.mon>Monday</th><th ng-if=vm.dayFilter.tue>Tuesday</th><th ng-if=vm.dayFilter.wed>Wednesday</th><th ng-if=vm.dayFilter.thu>Thursday</th><th ng-if=vm.dayFilter.fri>Friday</th><th ng-if=vm.dayFilter.sat>Saturday</th><th ng-if=vm.dayFilter.sun>Sunday</th></tr><tr class=subhead><th></th><th ng-if=vm.dayFilter.mon>Team</th><th ng-if=vm.dayFilter.tue>Team</th><th ng-if=vm.dayFilter.wed>Team</th><th ng-if=vm.dayFilter.thu>Team</th><th ng-if=vm.dayFilter.fri>Team</th><th ng-if=vm.dayFilter.sat>Team</th><th ng-if=vm.dayFilter.sun>Team</th></tr></thead><tbody><tr class=first-half-hour ng-repeat-start=\"hour in vm.hours track by $index\"><td id=\"{{vm.id + '-' + hour.time}}\">{{hour.time}}</td><td id=\"{{vm.id + '-' + hour.time + '-Monday'}}\" ng-if=vm.dayFilter.mon></td><td id=\"{{vm.id + '-' + hour.time + '-Tuesday'}}\" ng-if=vm.dayFilter.tue></td><td id=\"{{vm.id + '-' + hour.time + '-Wednesday'}}\" ng-if=vm.dayFilter.wed></td><td id=\"{{vm.id + '-' + hour.time + '-Thursday'}}\" ng-if=vm.dayFilter.thu></td><td id=\"{{vm.id + '-' + hour.time + '-Friday'}}\" ng-if=vm.dayFilter.fri></td><td id=\"{{vm.id + '-' + hour.time + '-Saturday'}}\" ng-if=vm.dayFilter.sat></td><td id=\"{{vm.id + '-' + hour.time + '-Sunday'}}\" ng-if=vm.dayFilter.sun></td></tr><tr class=second-half-hour ng-repeat-end><td>&nbsp;</td><td ng-if=vm.dayFilter.mon></td><td ng-if=vm.dayFilter.tue></td><td ng-if=vm.dayFilter.wed></td><td ng-if=vm.dayFilter.thu></td><td ng-if=vm.dayFilter.fri></td><td ng-if=vm.dayFilter.sat></td><td ng-if=vm.dayFilter.sun></td></tr></tbody></table></div>")}]),function(){function a(a,b,c,d,e){function f(a,b){var d=a.substring(0,2),e=a.substring(3,5),f=b.substring(0,2),g=b.substring(3,5),h=c({hour:d,minute:e});return c({hour:f,minute:g}).diff(h,"minutes")}function g(a,b){var c=a.substring(0,2)+":00",d=f(c,a),e=0;if(d>0){var g=d%30,h=(d-g)/30,i=g/30;e=b*h+Math.round(b*i+.5)-1}return e}function h(a,b){var c=a%30,d=(a-c)/30,e=c/30;return b*d+Math.round(b*e)-5}function i(a,b){var c=j(b),d=c.numerator/c.denominator;return Math.round(a*d)-5}function j(a){return{numerator:parseInt(a.substring(0,1)),denominator:parseInt(a.substring(2,3))}}function k(a,b,c){var d=j(b),e=1/d.denominator;return Math.round(c*e)*a}function l(c,d,e){var f=a[0].getElementById(c+"-"+e.substring(0,2)+":00-"+d);if(null!==f)var g=f.getBoundingClientRect(),h=Math.round(g.top),i=Math.round(g.left),j=Math.round(g.width),k=Math.round(g.height);return{left:b.scrollX+i+3,top:b.scrollY+h+2,width:j,height:k}}function m(c){var d=a[0].getElementById(c+"-Table");if(null!==d)var e=d.getBoundingClientRect(),f=e.top,g=e.height;return Math.round(b.scrollY+f+g)}function n(a,c){var d=m(a),e=c.top+b.scrollY+c.height,f=0;return d<e&&(f=e-d),f}function o(a,b,c){var d=0,e=0,g=null;return f(b,c.from)<0&&f(b,c.to)>0&&(g=l(a,c.day,b),d=h(f(b,c.to),g.height),e=i(g.width,c.fraction)),{coordinates:g,height:d,width:e}}var p={};return p.createBooking=function(b,c,e){var j=b+"-"+c.from.substring(0,2)+":00-"+c.day,m=l(b,c.day,c.from),p=angular.element('<div class="'+d.BOOKING+'"><span>'+c.fraction+"<br>"+c.from+" - "+c.to+"</span></div>"),q=h(f(c.from,c.to),m.height),r=i(m.width,c.fraction);q&&!isNaN(q)&&(p[0].style.height=q+"px"),r&&!isNaN(r)&&(p[0].style.width=r+"px");var s=m.left-1,t=m.top;isNaN(s)||(s+=k(c.position,c.fraction,m.width),p[0].style.left=s+"px"),isNaN(t)||(t+=g(c.from,m.height),p[0].style.top=t+"px");var u=a[0].getElementById(j);if(null!==u)angular.element(u).append(p);else{var v=o(b,e,c);if(0!==v.width&&0!==v.height){p[0].style.height=v.height+"px",p[0].style.width=v.width+"px",t=v.coordinates.top,p[0].style.top=t+"px",s=v.coordinates.left-1,s+=k(c.position,c.fraction,v.coordinates.width),p[0].style.left=s+"px";var w=a[0].getElementById(b+"-"+e+"-"+c.day);angular.element(w).append(p),p.addClass("cutTop")}}var x=n(b,p[0].getBoundingClientRect());if(x>0){var y=p[0].style.height.indexOf("px"),z=parseInt(p[0].style.height.substring(0,y));p[0].style.height=z-x+"px",p.hasClass("cutTop")?(p.removeClass("cutTop"),p.addClass("cutTopAndBottom")):p.addClass("cutBottom")}},p}angular.module("UI.Shifter.Calendar").factory("uiShifterCalendarEvent",["$document","$window","$moment","eventConst","uiShifterEvent",a])}(),function(){angular.module("UI.Shifter.Calendar").constant("$moment",moment).constant("eventConst",{BOOKING:"booking"})}(),function(){function a(a,b,c,d,e,f){var g=this,h=[];g.hours=[];var i=function(a,b){for(var d=[],e=a;e<=b;e++)d.push({time:c({hour:e,minute:0}).format("HH:mm")});g.hours=d},j=function(){k(),h.forEach(function(a){f.createBooking(g.id,a,g.hours[0].time)})},k=function(){for(var a=b[0].getElementsByClassName(d.BOOKING);a.length>0;)a[0].parentNode.removeChild(a[0])};a.$watch("vm.timeFilter",function(a,c){i(a.start,a.end),angular.element(b[0]).ready(function(){j()})},!0),a.$watch("vm.dayFilter",function(a,c){angular.element(b[0]).ready(function(){j()})},!0),a.$watch("vm.events",function(a,c){h=e.initEvents(g.events),angular.element(b[0]).ready(function(){j()})},!0),angular.element(b[0]).ready(function(){j()})}angular.module("UI.Shifter.Calendar").controller("uiShifterCalendarCtrl",["$scope","$document","$moment","eventConst","uiShifterEvent","uiShifterCalendarEvent",a])}(),function(){function a(a){}function b(){return{restrict:"AE",templateUrl:"src/templates/ui-shifter-calendar.tpl.html",controller:"uiShifterCalendarCtrl",controllerAs:"vm",scope:{id:"@",events:"=",timeFilter:"=",dayFilter:"=",shadow:"="},bindToController:!0,link:a}}angular.module("UI.Shifter.Calendar").directive("uiShifterCalendar",b)}(),function(){function a(){function a(a){var b=-1;switch(a){case"Monday":b=0;break;case"Tuesday":b=1;break;case"Wednesday":b=2;break;case"Thursday":b=3;break;case"Friday":b=4;break;case"Sunday":b=5;break;case"Saturday":b=6}return b}var b={};return b.initEvents=function(b){var c=angular.copy(b);return c.sort(function(b,c){return a(b.day)-a(c.day)}),c},b}angular.module("UI.Shifter.Calendar").factory("uiShifterEvent",a)}()}();